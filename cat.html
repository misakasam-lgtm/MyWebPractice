<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>猫咪赛跑</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .container {
              width: 90%;
               padding: 2vw;
}
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        thead {
            background-color: #ffb347;
            /* 渐变可以改成纯色或渐变 */
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        thead th {
            padding: 15px;
            text-align: left;
        }
        
        tr {
            background-color: #fff;
            transition: background-color 0.3s ease;
        }
        
        tr:nth-child(even) {
            background-color: #f7f7f7;
        }
        
        tr:hover {
            background-color: #ffe0b2;
        }
        
        tbody td {
            padding: 12px 15px;
        }
        
        caption {
            caption-side: top;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .tips {
            color: darkblue;
            font-size: clamp(12px, 4vw, 20px);
            font-weight: bold;
             display: flex;
            justify-content: center;
            align-items: center; /* 垂直居中 */
            gap: 2%;           /* 元素间距 */
            flex-wrap: wrap;
            margin-bottom: 2px;
        }
        .tips input, .tips button {
            display: inline-block;
        }
        @media (max-width: 500px) {
         .tips input, .tips button {
        display: inline-block;
        margin: 5px 0;
           }
        }
        #startBtn {
            margin: 20px;
        }
        
        #fish {
            background: deeppink
        }
    </style>
</head>

<body>
    <h1>猫咪赛跑</h1>
    <div class="tips">
        <canvas id="canvas"  style="border:1px solid deeppink;width:100%; max-width:800px; height:auto"></canvas><br>
    </div>

    <div class="tips"> 你的鱼干： <span  id="fish">2000</span> </div>
    <div class="tips"><label>你要使用:<input id = "user_bet" class=tips type="number"></label>给</div>
    <div class="tips">
        <label><input type="radio" name="chooseCat" value="Ace Taffy">Ace Taffy</label>
        <label> <input type="radio" name="chooseCat" value="Seren Azuma">Seren Azuma</label>
        <label> <input type="radio" name="chooseCat" value="NyaRu">NyaRu</label>
        <label>  <input type="radio" name="chooseCat" value="Diana">Diana</label>
    </div>
    <div class="tips">
        <button onclick="bet()">确认</button>
    </div>



    <table id="winner">
        <tr>
            <th>局数</th>
            <th>获胜猫</th>
        </tr>
    </table>
</body>
<script>
    addEventListener("load", clearcanvans)
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetWidth*0.65;
    let winner
    let catwidth = 0.05*canvas.width;
    let cats = [{
        x: canvas.width * 0.1,
        y: canvas.height * 0.3,
        color: "pink",
        name: "Ace Taffy"
    }, {
        x: canvas.width * 0.1,
        y: canvas.height * 0.5,
        color: "white",
        name: "Seren Azuma"
    }, {
        x: canvas.width * 0.1,
        y: canvas.height * 0.7,
        color: "aqua",
        name: "NyaRu"
    }, {
        x: canvas.width * 0.1,
        y: canvas.height * 0.9,
        color: "red",
        name: "Diana"
    }, ];

    function clearcanvans() {
        ctx.fillStyle = "aqua";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "lightgreen";
        ctx.fillRect(0, canvas.height * 0.2, canvas.width, canvas.height * 0.8);

        ctx.fillStyle = "#F00B0B";
        ctx.fillRect(canvas.width * 0.15, canvas.height * 0.2, 10, canvas.height * 0.8);
        ctx.fillRect(canvas.width *7 / 8, canvas.height * 0.2, 10, canvas.height * 0.8);

        let runway = [{
            x: canvas.width * 0.15 + 10,
            y: canvas.height * 0.4
        }, {
            x: canvas.width * 0.15 + 10,
            y: canvas.height * 0.6
        }, {
            x: canvas.width * 0.15 + 10,
            y: canvas.height * 0.8
        }, ];
        ctx.fillStyle = "white";
        runway.forEach(line => ctx.fillRect(line.x, line.y, canvas.width, 0.01*canvas.width));

        ctx.fillStyle = "deeppink";
        ctx.font = "clamp(8px, 2vw, 18px) sans-serif";
        cats.forEach(cat=>{ctx.fillText(cat.name, 0.015*canvas.width, cat.y + catwidth)});
    }

    function drawCat(ctx, x, y, size, color) {
        // 猫头
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x + size / 2, y + size / 2, size / 2, 0, Math.PI * 2);
        ctx.fill();

        // 左耳
        ctx.beginPath();
        ctx.moveTo(x + size * 0.1, y + size * 0.3);
        ctx.lineTo(x + size * 0.3, y - size * 0.3);
        ctx.lineTo(x + size * 0.5, y + size * 0.3);
        ctx.closePath();
        ctx.fill();

        // 右耳
        ctx.beginPath();
        ctx.moveTo(x + size * 0.5, y + size * 0.3);
        ctx.lineTo(x + size * 0.7, y - size * 0.3);
        ctx.lineTo(x + size * 0.9, y + size * 0.3);
        ctx.closePath();
        ctx.fill();

        // 眼睛
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.arc(x + size * 0.3, y + size * 0.4, size * 0.08, 0, Math.PI * 2);
        ctx.arc(x + size * 0.7, y + size * 0.4, size * 0.08, 0, Math.PI * 2);
        ctx.fill();

        // 胡子
        ctx.strokeStyle = "black";
        ctx.lineWidth = 1;
        ctx.beginPath();
        // 右边胡子
        ctx.moveTo(x + size * 0.7, y + size * 0.6);
        ctx.lineTo(x + size * 1.1, y + size * 0.5);
        ctx.moveTo(x + size * 0.7, y + size * 0.7);
        ctx.lineTo(x + size * 1.1, y + size * 0.6);
        ctx.moveTo(x + size * 0.7, y + size * 0.75);
        ctx.lineTo(x + size * 1.1, y + size * 0.75);
        // 左边胡子
        ctx.moveTo(x + size * 0.3, y + size * 0.6);
        ctx.lineTo(x - size * 0.1, y + size * 0.5);
        ctx.moveTo(x + size * 0.3, y + size * 0.7);
        ctx.lineTo(x - size * 0.1, y + size * 0.6);
        ctx.moveTo(x + size * 0.3, y + size * 0.75);
        ctx.lineTo(x - size * 0.1, y + size * 0.75);
        ctx.stroke();
    }

    let gameReady = true;
    function moveCat() {
            clearcanvans();
            cats.forEach(cat => {
                let speed = 0.5+ Math.random()*0.5
                 if (Math.random() < 0.005) {speed=100*Math.random()}
                cat.x += speed;
                drawCat(ctx, cat.x, cat.y, catwidth, cat.color);
            });
            if (!cats.some(cat => (cat.x > canvas.width - 0.12*canvas.width))) {
                gameReady = false
                requestAnimationFrame(moveCat);
            } else {
                winner = cats.find(cat => (cat.x > canvas.width - 0.12*canvas.width));
                winner_check()
                reset()
                clearcanvans();
                winnerCollect(winner.name);
            }
    }

    function main() {
        if (!gameReady) return
            clearcanvans();
            moveCat();
    }

    function reset() {
        cats = [{
        x: canvas.width * 0.1,
        y: canvas.height * 0.3,
        color: "pink",
        name: "Ace Taffy"
    }, {
        x: canvas.width * 0.1,
        y: canvas.height * 0.5,
        color: "white",
        name: "Seren Azuma"
    }, {
        x: canvas.width * 0.1,
        y: canvas.height * 0.7,
        color: "aqua",
        name: "NyaRu"
    }, {
        x: canvas.width * 0.1,
        y: canvas.height * 0.9,
        color: "red",
        name: "Diana"
    }, ];
        gameReady = true;
        choiceon = true;
    }
    let gametimes = 0

    function winnerCollect(a) {
        gametimes += 1;
        const tableBody = document.getElementById("winner");
        const tr = document.createElement("tr");
        tr.innerHTML = `
      <td>${gametimes}</td>
      <td>${a}</td>
    `;
        tableBody.appendChild(tr)
    }
    let user_choice = {cat:null,amount:0}
    let choiceon = true
    const ratio = document.getElementsByName("chooseCat");
    function bet(){
        if (!gameReady) return;
        if(!choiceon)return;
         const user_bet = Number(document.getElementById("user_bet").value);
         let user_cat = null
        if(Number(document.getElementById("fish").innerText) - user_bet>=0) {
            ratio.forEach(c => {
                if (c.checked) {
                    user_cat = c.value
                }
            });
            if(user_cat === null || user_bet===0){
                alert("请正确投喂！")
                return;
            }
            user_choice.cat = user_cat;
            user_choice.amount = user_bet;
            alert("你给" + user_choice.cat + "投喂了" + user_choice.amount);
            let last_fish = Number(document.getElementById("fish").innerText) - Number(user_choice.amount);
            document.getElementById("fish").innerHTML = `${last_fish}`;
            choiceon = false;
            main()
        }
        else {
            alert("没鱼了喵")
        }
    }
    let winfish = 0
    function winner_check(){
        if (user_choice.cat === winner.name){
            winfish = 2*user_choice.amount;
            alert(winner.name+"获胜"+"你赢得了"+winfish);
            let newfish = Number(document.getElementById("fish").innerText) + winfish
            document.getElementById("fish").innerHTML = `${Number(newfish)}`;
            user_choice = {cat:null,amount:0}
        }
        else {
            if (Number(document.getElementById("fish").innerText) === 0) {
                alert("破产了喵")
            }

            else {
            alert("没猜中，你的鱼被吃完了喵，获胜者是"+winner.name)
                    }
        }
    }
    setInterval(function setloop() {if(!gameReady)document.getElementById("fish").innerText = Number(document.getElementById("fish").innerText) + 20},1000
    )

</script>

</html>