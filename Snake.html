<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>贪吃蛇</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body{
            text-align: center;
        }
        #score{
            color: darkblue;
            font-weight: bold;
            text-align: center;
            background: deeppink;
            display: inline-block;
            margin: 2px;
        }
        #times{
            color: darkblue;
            font-weight: bold;
            text-align: center;
            background: deeppink;
            display: inline-block;
            margin: 2px;
        }
        button{
            color: white;
            background: deeppink;
            font-weight: bold;
            font-size: 28px;
            margin: 2px auto;
        }
        .opbtm{
            width: 120px;
            height:120px;
        }
        hr{
            width: 60%;
        }
        button:hover {
    transform: scale(1.05);
    background: #ffafc4;}
    </style>
</head>
<body>
<h1>贪吃蛇喵</h1>
<div style="text-align: center"><div id="score">分数:0分喵</div><br><div id="times">你已游玩0次</div></div>
<canvas id = "Snakegame" width="400" height="400"></canvas><hr>
<button class = "opbtm" id = "up" onclick="move(0,-1)">↑</button>
<br>
<button class = "opbtm" id = "left" onclick="move(-1,0)" style="">←</button>
<button class = "opbtm" id ="down" onclick="move(0,1)">↓</button>
<button class = "opbtm" id = "right" onclick="move(1,0)" style="">→</button>


<hr>
<button id = "startbtn" onclick="gamestart()">开始喵！</button>
<br><button id = "shutdownbtn" onclick="move(0,0)">暂停一下！</button>

</body>
<script>
const convas = document.getElementById("Snakegame");
const ctx = convas.getContext("2d");
const  SnakeSize = 20
let score = 0;
let snake =[
    {x:200,y:200},
    {x:190,y:200},
    {x:180,y:200},
]
let food = {x:100,y:100}
let speed = 200;
function NewFood() {
    food.x =SnakeSize * Math.floor(Math.random() * convas.width/SnakeSize);
    food.y =SnakeSize * Math.floor(Math.random() * convas.height/SnakeSize)
    if(speed>55)
    speed -= 5
    drawFood()

}
let dx = SnakeSize;
let dy = 0

function move(a,b) {
    if ((dx===0 && b*SnakeSize !== -dy)||(dy===0 && a*SnakeSize !== -dx)) {
        dx = a * SnakeSize;
        dy = b * SnakeSize;
    }
}

function clearCanvas(){
    ctx.fillStyle = "white";
    ctx.fillRect(0,0,convas.width,convas.height);
}//绘制和清空背景
function drawSnake(){
    ctx.fillStyle = "pink";
    snake.forEach(segment=>{
    ctx.fillRect(segment.x,segment.y,SnakeSize,SnakeSize);})
}
function  drawFood(){
    ctx.fillStyle = "green";
    ctx.fillRect(food.x,food.y,SnakeSize,SnakeSize);
}
function moveSnake() {
    const head = {x: snake[0].x + dx, y: snake[0].y + dy}
    if (head.x < 0 || head.x > convas.width || head.y < 0 || head.y > convas.height||snake.some(segment=> segment.x===head.x && segment.y===head.y)) {
        alert("似了喵T T")
        gametimes +=1
        document.getElementById("times").innerHTML = "你已游玩"+gametimes+"次";
        reset()
    }
    else {
        snake.unshift(head)
        if (head.x === food.x && head.y === food.y) {
            score = score + 1
            updatesocre()
            NewFood()
        } else {
            snake.pop()
        }
    }
}
function updatesocre(){
    document.getElementById("score").innerHTML = "分数:"+score+"分喵";
}
let gametimes = 0
function gamestart(){
    document.getElementById("score").innerHTML = "分数:"+0+"分喵"
    gametimes += 1;
    if(gametimes < 2){
        main()
    }
    else {
        clearTimeout(gameloop)
        reset()
        main()
    }
    document.getElementById("times").innerHTML = "你已游玩"+gametimes+"次";
}
function main() {
    gameloop = setTimeout(function tick() {
        clearCanvas()
        moveSnake()
        drawSnake()
        drawFood()
        main()
    },speed);
}
function reset(){
    clearTimeout(gameloop)
    snake =[
    {x:200,y:200},
    {x:190,y:200},
    {x:180,y:200},]
     score = 0
    speed = 200
    dx = SnakeSize;
    dy = 0
    drawSnake()
    NewFood()
    document.getElementById("score").innerHTML = "分数:"+0+"分喵"
}
</script>
</html>