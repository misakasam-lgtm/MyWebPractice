<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小鸟游戏</title>
    <link rel="stylesheet" href="style.css">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        #score{
            font-size: clamp(18px, 5vw, 30px);
            color: darkblue;
            font-weight: bold;
            text-align: center;
            background: deeppink;
            display: inline-block;
            margin: 2px;
        }
          body{
              margin: 4vw;
            text-align: center;
           }
    </style>
</head>
<body>
<div id = "HeadLine"></div>
<div id="score">分数:0分喵</div><hr>
<canvas id="canvas" style="max-width: 800px ;height:auto" onclick="jump()"></canvas>
<hr>
<button id = "startbtn" onclick="startgame()">开始</button>
<button onclick="freeze()">暂停/继续</button>

</body>
<script src="HeadLine.js"></script>
<script>
    addEventListener("load",loadHeadLine);
    addEventListener("resize",updatescreen)
    addEventListener("load",updatescreen)
    addEventListener("load",clearCanvas)
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let birdbody
    function updatescreen() {
    canvas.width = innerWidth*0.95;
    canvas.height = innerWidth*0.75;
    birdbody = Math.floor(canvas.width/40);
    }
    let score = 0;
    let gamelife = true
    let bird = []
    let block1 = []
    let block2 = []
    let dx
    let dy
    let speed = 100
    function clearCanvas() {
        ctx.fillStyle = "#cceeff";
         ctx.fillRect(0, 0, canvas.width, canvas.height); // 天空蓝背景
         ctx.fillStyle = "green";
        ctx.fillRect(0, canvas.height - 3*birdbody, canvas.width, 3*birdbody); // 地面
        ctx.fillStyle = "white";
        ctx.shadowColor = "rgba(0,0,0,0.2)";
        ctx.shadowBlur = 15;
        ctx.roundRect(5*birdbody, 3*birdbody, 10*birdbody , 3*birdbody,3*birdbody);//云
        ctx.roundRect(canvas.width-3*birdbody, 3*birdbody, 10*birdbody , 5*birdbody,3*birdbody);
        ctx.fill()
    }
    function drawbird() {
        ctx.fillStyle = "yellow";
          if(bird[0].y >canvas.height+birdbody||bird[0].y <0-2*birdbody){
            gamelife = false;
          reset()}
        bird.forEach(a=>
            a.y+=dy+birdbody/5,
            ctx.fillRect(a.x, a.y, birdbody, birdbody));
    }
    function movebird() {
        const birdposition = {x:bird[0].x ,y:bird[0].y + dy};
        dy = dy +birdbody/5;
        bird.unshift(birdposition);
        bird.pop()
        drawbird()
    }
    function speedup() {
        if(speed>50) {
                    clearInterval(gameloop)
                    speed -= 1
                    main()
                }
    }
    let scoreplus = true
    function moveblock() {
         clearCanvas()
        if(-birdbody>bird[0].x -block1[0].x){
            scoreplus = true;
        }
        if (-birdbody<=bird[0].x -block1[0].x) {
            if (bird[0].y < block1[0].y-birdbody*0.5 || bird[0].y > block2[0].y+birdbody*0.5) {
                gamelife = false;
                startgame()
            } else {
                nextblock()
                if(scoreplus) {
                    score += 1
                    scoreplus = false
                }
                movebird()
                block1.forEach(setment=>{
                    setment.x -=birdbody
                    ctx.fillStyle = "darkblue"
                    ctx.fillRect(setment.x,setment.y,birdbody,-setment.y)
                })
                block2.forEach(setment=>{
                    setment.x -=birdbody
                    ctx.fillStyle = "darkblue"
                    ctx.fillRect(setment.x,setment.y,birdbody,canvas.height-setment.y)
                })
            }
        } else {
                movebird()
                nextblock()
              block1.forEach(setment=>{
                    setment.x +=birdbody
                    ctx.fillStyle = "darkblue"
                    ctx.fillRect(setment.x,setment.y,birdbody,-setment.y)
                })
                block2.forEach(setment=>{
                    setment.x +=birdbody
                    ctx.fillStyle = "darkblue"
                    ctx.fillRect(setment.x,setment.y,birdbody,canvas.height-setment.y)
                })
        }
    }
    function newblock() {
        const newblock = Math.floor(Math.random() * canvas.height*3/4)
        block1.unshift({x:canvas.width + dx,y:newblock});
        block2.unshift({x:canvas.width + dx,y:newblock + 6*birdbody});
        while (block1.length>2) {
            block1.pop()
            block2.pop()
        }
    }
    function nextblock() {
        if (2*birdbody > block1[0].x) {
            newblock()
        }
    }
    function jump(){
        dy = birdbody
        const birdjump = {x:bird[0].x,y:bird[0].y - 4*dy};
        bird.unshift(birdjump)
    }
    let pause = false
    function main() {
        setInterval(function() {
            if (!pause) {
                moveblock()
            }
        },200)
    }
    let gametimes = 0
    function startgame(){
        updatescreen();
        reset()
        gametimes += 1;
        if(gamelife) {
            if (gametimes < 2) {
                resetposition()
                main()
            } else {
                reset()
                main()
            }
        }
        else {
            alert("似了喵")
            reset()
            startgame()
        }
    }
    function resetposition() {
        bird = [
        {x:canvas.width*0.3,y:canvas.height*0.5},
    ]
       block1 = [{x:canvas.width*0.6,y:canvas.height*0.6}]
        block2 = [{x:canvas.width*0.6,y:canvas.height*0.6+6*birdbody}]
        newblock()
         scoreplus = true
        dx = -birdbody
        dy = birdbody
    }
    function reset(){
        resetposition()
        clearCanvas()
        score = 0
        document.getElementById("score").innerHTML= "分数:"+score+"分喵"
        speed = 100
        gamelife = true
    }
    function freeze() {
        pause = !pause
    }

</script>
</html>