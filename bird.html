<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小鸟游戏</title>
    <link rel="stylesheet" href="style.css">
    <style>
        button{
            color: white;
            background: deeppink;
            font-weight: bold;
            font-size: 50px;
            margin: 10px auto;
        }
         button:hover {
    transform: scale(1.05);
    background: #ffafc4;}
        #score{
            font-size: 30px;
            color: darkblue;
            font-weight: bold;
            text-align: center;
            background: deeppink;
            display: inline-block;
            margin: 2px;
        }
          body{
              margin: auto;
            text-align: center;
            width: 60%;
           }
    </style>
</head>
<body>
<h1>小鸟游戏</h1>
<div id="score">分数:0分喵</div><hr>
<div style="display: flex;align-items: center;justify-content: center;">
<canvas id="canvas" width="800" height="600" onclick="jump()"></canvas>
    </div>
<hr>
<div style="text-align: center"><button id = "startbtn" onclick="startgame()">开始</button> </div>
   <button onclick="freeze()">暂停/继续</button>

</body>
<script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const birdbody = 20
    let score = 0;
    let gamelife = true
    let bird = [
        {x:200,y:300},
    ]
    let block1 = [
        {x:500,y:250},
    ]
    let block2 = [
        {x:500,y:400},
    ]
    let dx = -birdbody
    let dy = birdbody
    let speed = 100
    function clearCanvas() {
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }
    function drawbird() {
        ctx.fillStyle = "yellow";
          if(bird[0].y >canvas.height+birdbody||bird[0].y <0-2*birdbody){
            gamelife = false;
          startgame()}
        ctx.fillRect(bird[0].x, bird[0].y, birdbody, birdbody);
    }
    function createblock(){
        ctx.fillStyle = "black";
        block1.forEach(setment=>{ctx.fillRect(setment.x, setment.y, birdbody, -setment.y)
    })
        block2.forEach(setment=>{ctx.fillRect(setment.x, setment.y, birdbody, canvas.height-setment.y)
    })
    }
    function movebird() {
        const birdposition = {x:bird[0].x ,y:bird[0].y + dy};
        dy = dy +birdbody/5;
        bird.unshift(birdposition);
        bird.pop()
        drawbird()
    }
    let scoreplus = true
    function moveblock() {
        const blockposition1 = {x: block1[0].x + dx, y: block1[0].y};
        const blockposition2 = {x: block2[0].x + dx, y: block2[0].y};
        if(-birdbody>bird[0].x -block1[0].x){
            scoreplus = true;
        }
        if (-birdbody<=bird[0].x -block1[0].x) {
            if (bird[0].y < block1[0].y-birdbody || bird[0].y > block2[0].y+birdbody) {
                gamelife = false;
                startgame()
            } else {
                if(scoreplus) {
                    score += 1
                    scoreplus = false
                }
                block1.unshift(blockposition1)
                block2.unshift(blockposition2)
                block1.pop()
                block2.pop()
                document.getElementById("score").innerHTML= "分数:"+score+"分喵"
            }
        } else {
            block1.unshift(blockposition1)
            block2.unshift(blockposition2)
            block1.pop()
            block2.pop()
        }
    }
    function newblock() {
        block1.unshift({x:canvas.width + dx,y:250-Math.floor(Math.random() * canvas.height/3)});
        block2.unshift({x:canvas.width + dx,y:block1[0].y + 150});
            block1.pop()
            block2.pop()
    }
    function nextblock() {
        if (bird[0].x > block1[0].x) {
            newblock()
        }
    }
    function jump(){
        dy = birdbody
        const birdjump = {x:bird[0].x,y:bird[0].y - 4*dy};
        bird.unshift(birdjump)
    }
    let pause = false
    function main() {
        gameloop = setInterval(function game() {
                    clearCanvas()
                    if (!pause) {
                        movebird()
                        moveblock()
                        createblock()
                        nextblock()
                    }
            }, speed);
    }
    let gametimes = 0
    function startgame(){
        gametimes += 1;
        if(gamelife) {
            if (gametimes < 2) {
                main()
            } else {
                reset()
                main()
            }
        }
        else {
            alert("似了喵")
            reset()
            startgame()
        }
    }
    function reset(){
        clearInterval(gameloop)
        clearCanvas()
        bird = [
        {x:200,y:300},
    ]
       block1 = []
        block2 = []
    // 初始化第一根柱子
         block1.push({x:500, y:250});
         block2.push({x:500, y:400});
         scoreplus = true
        dx = -birdbody
        dy = birdbody
        score = 0
        document.getElementById("score").innerHTML= "分数:"+score+"分喵"
        speed = 100
        gamelife = true
    }
    function freeze() {
        pause = !pause
    }

</script>
</html>