<!DOCTYPE html>
<html lang="cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒ«ã®ç¥ç¤¾</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body{
            background-color: #FFC1CC;
            background-image:
            repeating-linear-gradient(90deg, darkgray 0 3px, transparent 5px 30px);
        }
        canvas {
         position: fixed;   /* å›ºå®šåœ¨å±å¹•ä¸Š */
        top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         pointer-events: none; /* é¼ æ ‡äº‹ä»¶ç©¿é€ï¼Œä¸æŒ¡æŒ‰é’®ç‚¹å‡» */
         z-index: 0;          /* æ”¾åœ¨æœ€åº•å±‚ */
            }
        label{
            font-weight: 600;
            display: block;
            font-size:clamp(18px, 3vw, 30px);
            margin-bottom: 1vw;
            color: #FF5A5A;
            text-shadow:   2px 0 white,
                          -2px 0 white,
                           0 2px white,
                           0 -2px white;
        }
        input{
            width: 50vw;
            height: 2vw;
            background: #C7B6FF;
            color: white;
            border-radius: 10px;
            padding: 5px;
            outline: none;
            border: 1vw solid white;
            font-size: clamp(12px, 3vw, 20px);
        }
        input::placeholder{
            color: #E1E1E1;
        }
        button{
            border-radius: 10px;
            background-color: red;
        }
        #result{
            background-color: #C7B6FF;
            height: clamp(50px, 15vh, 300px);
            width: 50vw;
            color: black;
            border-radius: 10px;
            padding: 5px;
            outline: none;
            border: 1vw solid white;
            font-size: clamp(12px, 3vw, 20px);
            resize: none;
        }
        textarea::placeholder{
            color: #E1E1E1;
        }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<h1>çŒ«ã®ç¥ç¤¾</h1>
<h1 style="font-size: clamp(30px,15vw,80px)">ğŸˆâ€â›©ï¸ğŸˆâ€</h1>
<div style="margin-top: clamp(30px, 20vw, 50px);)">
<label for="things">ä½ ä»Šå¤©è¦å åœçš„äº‹æ˜¯ï¼Ÿ</label>
<input id="things" type="text" placeholder="ä»Šå¤©èƒ½åƒåˆ°é±¼å—ï¼Ÿ">
    <br>
<button style="margin: 2vw" onclick="getFortune()">æŠ½ç­¾</button><br>
    <label for="result" >è§£ç­¾</label><textarea id="result" type="text" readonly placeholder="ç¥ä½ å¥½è¿å–µ"></textarea>
</div>
<img src="img/right01.jpg" alt="å›¾æ²¡äº†å–µ" style="position: fixed;right: 1px;bottom:1px;width: auto;max-height:30vh">
<img src="img/left01.jpg" alt="å›¾æ²¡äº†å–µ" style="position: fixed;left: 1px;bottom:1px;width: auto;max-height:30vh">
</body>

<script>
    const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;

window.addEventListener('resize', () => {
  width = canvas.width = window.innerWidth;
  height = canvas.height = window.innerHeight;
});

// åˆ›å»ºæ¨±èŠ±
const petals = [];
const petalCount = 20;

for (let i = 0; i < petalCount; i++) {
  petals.push({
    x: Math.random() * width,
    y: Math.random() * height,
    size: 5 + Math.random() * 10,
    speedY: 1 + Math.random() * 2,
    speedX: Math.random() * 1 - 0.5,
    angle: Math.random() * 360,
    rotationSpeed: Math.random() * 0.02 - 0.01
  });
}

// ç»˜åˆ¶æ¨±èŠ±
function drawPetal(p) {
  ctx.save();
  ctx.translate(p.x, p.y);
  ctx.rotate(p.angle);
  ctx.fillStyle = 'pink';
  ctx.beginPath();
  ctx.ellipse(0, 0, p.size, p.size * 0.6, 0, 0, 2 * Math.PI);
  ctx.fill();
  ctx.restore();
}

// åŠ¨ç”»å¾ªç¯
function animate() {
  ctx.clearRect(0, 0, width, height);

  for (let p of petals) {
    p.y += p.speedY;
    p.x += p.speedX;
    p.angle += p.rotationSpeed;

    if (p.y > height) {
      p.y = -10;
      p.x = Math.random() * width;
    }

    if (p.x > width) p.x = 0;
    if (p.x < 0) p.x = width;

    drawPetal(p);
  }

  requestAnimationFrame(animate);
}

animate();

//å åœ
const playerID = localStorage.getItem('logPlayerID');
const playerName = localStorage.getItem('logPlayerName');
const today = new Date().toLocaleDateString("zh-CN",{timeZone:'Asia/Shanghai'}).replace(/\//g,'-');
addEventListener('load', logCheck);
function logCheck() {
    if (!playerID) {
        alert("è¯·å…ˆç™»å½•å–µ")
        window.location.href = "./index.html";
    }
}
const results = ['ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–:å‡ºä¹æ„æ–™çš„å¥½è¿å–µï¼Œæœ¬çŒ«è§‰å¾—ä½ ä»Šå¤©å¾ˆé€‚åˆ{q}å–µ',
    'ğŸ’–ğŸ’–ğŸ’–ğŸ’–:å¥½è¿å–µï¼Œæ®è¯´{q}çš„æ—¶å€™å¿ƒé‡Œå–µå–µå«å°±ä¸ä¼šæœ‰é—®é¢˜äº†å–µ',
    'ğŸ’–ğŸ’–ğŸ’–:å–µå‘œï¼Œæœ¬çŒ«ä¹Ÿæ„Ÿè§‰å›°æƒ‘äº†å–µï¼Œ{q}è¿™ä»¶äº‹ä¼¼ä¹å–œå¿§å‚åŠå‘¢',
    'ğŸ’–ğŸ’–:å¦‚æœä½ æ˜¯ä¸ªå†’é™©å®¶çš„è¯ï¼Œå€¼å¾—åœ¨ä»Šå¤©å°è¯•ä¸‹{q}å–µ',
    'ğŸ’–:ææ€–å–µï¼Œæœ¬çŒ«å»ºè®®ä½ ä»Šå¤©æœ€å¥½ä¸è¦{q}å–µ',
    ];
function hashString(str) {
  let hash = 2166136261;
  for (let i = 0; i < str.length; i++) {
    hash ^= str.charCodeAt(i);
    hash += (hash << 1) + (hash << 4) + (hash << 7) + (hash << 8) + (hash << 24);
  }
  return hash >>> 0;
}

function seededRandom(s) {
  s = (s * 9301 + 49297) % 233280;
  return s / 233280;
}
function getFortune() {
  const question = document.getElementById('things').value
    if (!question) {
        alert("ä¸å¯ä»¥ä»€ä¹ˆä¹Ÿä¸é—®å–µ!")
        return
    }
  const seed = hashString(question + today + playerID);
  const index = Math.floor(seededRandom(seed) * results.length);
  const text = results[index].replace('{q}',question);
  document.getElementById('result').value = `ç”±äºä½ çš„è™”è¯šå‚æ‹œï¼ŒçŒ«å’ªå›åº”ä½ :
  ${text}ã€‚
  (${playerName}äº${today}å‚æ‹œ)`;
}
</script>
</html>