<!DOCTYPE html>
<html lang="CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>喵险随从</title>
    
    <style>
        input{
            height: clamp(10px,5vw,25px);
            width: clamp(80px,20vw,150px);
            margin-top: 1vh;
            border-radius: 5px;
            border: 2px solid #ff6f91;
        }
        .bg {
              position: absolute;
              top: 0;
              left: 0;
              width: 100vw;
              height: 100vh;
              background-size: cover;      
              background-position: center; 
              background-repeat: no-repeat;
              z-index: -1;
              background-image: url("img/pet/background.jpg");       
             }
        
        #gameCanvas {
            image-rendering: pixelated;
            width: clamp(300px,20vw,900px);
            height: clamp(450px,30vw,1200px);
            position: fixed;
            transform: translate(-50%);
            bottom: 10%;
            left: 35%;
            z-index: 1000;
            cursor:crosshair;
        }
        #gameCanvas:hover{
            transform: translate(-50%) scale(1.1);
            bottom: 15%;
        }
        p{
            margin: 0;
            font-size: clamp(18px,4vw,30px);
            color: rgba(220,100, 100,1);
            font-weight: 700;
            text-shadow:    
            3px 0 white,
            -3px 0 white,
            0 3px white,
            0 -3px white;
            user-select: none;
}
        
    button{
    width: clamp(60px,13vw,200px);
    height: clamp(35px,8vw,120px);
    font-size: clamp(10px,4vw,50px);
    font-weight: 700;
    background:linear-gradient(150deg,rgba(200, 150,150, 1),rgba(200, 50,50, 1));
    color: white;
    border: 5PX solid white;
    border-radius: 2vw;
    cursor: pointer;
    image-rendering: pixelated; 
    transition: transform  0.2s;
    margin-left: 10px;
    user-select: none;
    }

    button:active {
        transform:scale(0.9);
        background: #ffaa00;
    }
    
    button:hover{
        transform: scale(1.1);
        background: rgba(200, 50,50, 1);
    }
    .abillity{
        display: flex;
        flex-direction: column;
        gap: 15px;   
        background-color: rgba(255,255, 255,0.6);
        border-radius: 5px;
        box-shadow: 0 4px 15px rgba(255, 182, 193, 0.3);
        padding: 5px;
        text-align: left;
        transition: 0.3s;
        backdrop-filter: blur(5px) saturate(150%);
        border: 5px solid rgba(255, 255, 255, 0.6);
        flex: 1 1 280px;
        width: clamp(150px,30vw,500px);
        position: fixed;
        top: 1%;
        right: 1%;
        user-select: none;
    }
    .abillity:hover{
        transform: scale(1.05);
        top: 2%;
    }
    .buttonCantainer{
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-start;
    }
    .bottomLine{  
        background-color: rgba(0,0, 0,0.8);
        border-radius: 5px;
        padding: 5px;
        text-align: left;
        transition: 0.3s;
        color: white;
        font-weight: 700;
        backdrop-filter: blur(5px) saturate(150%);
        border: 1px solid rgba(255, 255, 255, 0.6);
        width: 98vw;
        position: fixed;
        transform: translateX(50%);
        right: 50%;
        bottom: 0;
        z-index: 1000;
        font-size: 4vh;
        user-select: none;
    }
    #alernText{
        font-size: 3vh;
        text-align: center;
    }
    #EXPcanvas{
        left: 1%;
        margin-left:8px;
        width:90%;
        height: 3vh;
    }
    .buttonCantainer{
        display: flex;
        flex-direction: column;
        gap: 20px;
        width:clamp(150px,30vw,500px);
        height: 30vh;
        background: linear-gradient(150deg,rgba(255,255, 255,0.6),rgba(255,255, 255,0.3),rgba(255,255, 255,0.1));
        border-radius: 15px;
        padding-left: 10px;
        text-align: left;
        transition: 1s;
        color: white;
        font-weight: 700;
        backdrop-filter: blur(1px) saturate(150%);
        border: 3px solid rgba(255, 255, 255, 0.6);
        position: fixed;
        transform: translateX(50vw);
        bottom: 20%;
        right: 35vw;
        z-index: 1000;
        font-size: 4vh;
        user-select: none;
    }
    .buttonCantainer:hover{
    right: 50vw;
    }
    .feedFish{
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: fixed;
        right: 50%; 
        top: 35%;
        transform: translatex(50%);
        z-index: 1000;
        background-color: rgba(255,255, 255,0.6);
        border-radius: 5px;
        box-shadow: 0 4px 15px rgba(255, 182, 193, 0.3);
        padding: 5px;
        text-align: left;
        transition: 0.3s;
        backdrop-filter: blur(5px) saturate(150%);
        border: 5px solid rgba(255, 255, 255, 0.6);
        width: clamp(200px,30vw,500px);
        flex: 1 1 280px;
        font-size: clamp(18px,4vw,50px);
            color: rgba(220,100, 100,1);
            font-weight: 700;
            text-shadow:    
            3px 0 white,
            -3px 0 white,
            0 3px white,
            0 -3px white;
    }
    .feedFish.show{
        display: flex;
    }
    #feedExit{
        position: absolute;
        top: 0;
        right: 0;
        padding: 0;
        border: none;
        background: none;
        border-radius: 0;
        width: clamp(20px,6vw,30px);
        height: clamp(20px,6vw,30px);
        font-size: clamp(20px,6vw,30px);
        color: rgba(200, 150,150, 1);
        margin: 0;
    }
    #feedup{
        width: clamp(50px,15vw,100px);
        height: clamp(30px,6vw,60px);
        margin-top: 15px;
        font-size: clamp(10px,3vw,30px)
    }
    .spinner{
        display: inline-block;
        width: clamp(8px,4vw,16px);
        height: clamp(8px,4vw,16px);
        border: 6px solid rgba(255, 255, 255, 0.8);
        border-top: 6px solid rgba(200, 150, 150, 0.8);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .battleArea{
        display: none;
        position: fixed;
        transform: translateX(50%) translateY(-50%);
        top: 50%;
        right: 50%;
        width: clamp(300px,100vw,800px);
        height: clamp(200px,70vw,400px);
        background-color: rgba(255, 255, 255, 1);
        z-index: 2000;
    }
    .battleArea.show{
        display: block;
    }
    #battleCanvas{
        width: 20%;height: 33%;
        position: absolute;
        left: 15%;
        bottom: 50%;
    }
    #battleEscape{
        position: absolute;
        right: 5%;
        bottom: 5%;
        width: clamp(60px,10vw,100px);
        height: auto;
        font-size: clamp(12px,4vw,20px);
        border-radius: 10px;
    }
    #enemyCanvas{
        width: 20%;height: 50%;
        position: absolute;
        left: 65%;
        bottom: 50%;
    }
       
    </style>
</head>

<body>
    <div class="bg"></div>
    <canvas id="gameCanvas"></canvas>
    <div class="abillity">
    <p>你的喵险随从</p>
    <p>名称：^ω^</p>
        <p>等级：<span id = 'level'><span class="spinner"></span></span></p>
    <p>你的鱼干：<span id="fish"><span class="spinner"></span></span></p>
    <p>EXP：<span id="petEXP"><span class="spinner"></span></span></p>
    </div>
    <div class="buttonCantainer">
        <p>行动</p>
        <div>
            <button id="feedBtm">喂食</button>
            <button id="battle">冒险</button>
        </div>
    </div>
    <div id='feedFishiWin' class = "feedFish">
        <button id="feedExit">×</button>
        <label for="usingFish" style="font-size: clamp(20px,6vw,35px);">你要投喂</label><input type="text" id="usingFish">
        <button id='feedup' >提交</button>
    </div>
    <div class="bottomLine">
        <div id="alernText">天气不错喵</div>
        <div style="width: 100%;">EXP:<canvas id="EXPcanvas"></canvas></div>
    </div>
    <div id='battleWin' class="battleArea">
        <canvas id="battleCanvas"></canvas>
        <canvas id="enemyCanvas"></canvas>
        <button id="battleEscape">逃跑</button>
    </div>
    

</body>
<script src="fish.js"></script>
<script src="animetion.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.umd.js"></script>
<script>
    const playerPet = 0
    const playerEnemy = 0
     const imgIndex = [
        {name:"red",
        actions:{
            stand:{src:'./img/pet/stand.png',json:'./img/pet/stand.json',speed:200},
            eat:{src:"./img/pet/eat.png",json:"./img/pet/eat.json",speed:100},
            sword:{src:"./img/pet/sword.png",json:"./img/pet/sword.json",speed:60}
                }
        }   
    ]
    const enemyIndex = [
        {name:"enemy1",
        actions:{
            stand:{src:'./img/pet/enemy1.png',json:'./img/pet/enemy1.json',speed:200},
                }
        }   
    ]
    const pet = new spriteAnimate('gameCanvas',imgIndex,playerPet)
    addEventListener('load',async ()=>{
         await feedPet(0)
         updateLevel()
         await pet.start('stand')
     })
   
   
    const mainCanvas = document.getElementById('gameCanvas')
    let back = null
    mainCanvas.addEventListener('click',taptap)
    function taptap(){
        const replyWord = [
        '有什么事喵？',
        '要去冒险吗？',
        '别摸耳朵喵！',
        '要喂我鱼干吗？',
        '王牌级喵险家参上喵',
        '呃呃喵'
        ]
        const reply = Math.floor(Math.random()*replyWord.length)
        document.getElementById("alernText").textContent = replyWord[reply]
        clearTimeout(back)
        back = setTimeout(() => {
            document.getElementById("alernText").textContent = waitWord
        }, 2000);
    }

     const waitWord = '天气不错喵'
    let eatback = null
      async function feed(){
        let amount = Number(document.getElementById('usingFish').value)
          if(amount<=0){
              alert("太小气了喵")
              return }
          await feedPet(amount)
          await pet.setAction('eat')
          clearTimeout(eatback)
          eatback = setTimeout(()=>{pet.setAction('stand')},4000)
          feedReply(amount)
          updateLevel()
         document.getElementById('feedFishiWin').classList.remove('show')
    }
    function feedReply(amount){
         let reply = null
         if(amount<=2000){reply = 0}
         else if(amount<=5000){reply = 1}
         else if(amount<=10000){reply = 2}
         else if(amount<=20000){reply = 3}
         else if(amount<=50000){reply = 4}
         else {reply = 5}
         const relyText=[
             '虽然不多，但是谢谢了喵',
             '谢谢喵，看来今天可以吃饱了',
             '哦呀，没想到你还挺大方的喵',
             '难得的丰盛喵，你今天赛跑猜中了？',
             '今天的任务很困难吗？。。',
             '你你你，挑战领主的任务我可不去哦？！'
         ]
        document.getElementById("alernText").textContent = relyText[reply]
        back = setTimeout(() => {
            document.getElementById("alernText").textContent = waitWord
        }, 2000);
    }
    document.getElementById("feedup").addEventListener('click',feed)
    document.getElementById("feedBtm").addEventListener('click',showfeed)
    document.getElementById("feedExit").addEventListener('click',()=>{
    document.getElementById('feedFishiWin').classList.remove('show')
    })
    function showfeed(){
        document.getElementById('feedFishiWin').classList.add('show')
    }
    function remove(){
        this.value = this.value
        .replace(/\D/g,"")
    }
    document.getElementById('usingFish').addEventListener("input", remove);
     function updateLevel(){
        const EXP = Number(document.getElementById('petEXP').textContent);
        document.getElementById("level").textContent = `${Math.floor(EXP/10000)+1}级`
         drawEXP(EXP)
     }
     function drawEXP(EXP){
        const canvas = document.getElementById("EXPcanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight
        let EXPline = (EXP %10000)/10000 * canvas.width;
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "green";
        ctx.fillRect(0, 0, EXPline, canvas.height);
    }

 //战斗部分
    const battlePet = new spriteAnimate('battleCanvas',imgIndex,playerPet)
    const enemy = new spriteAnimate('enemyCanvas',enemyIndex,playerEnemy)
   
    async function showBattle(){
         document.getElementById('battleWin').classList.add('show')
         await battlePet.start('sword')
         await enemy.start('stand')
    }
    function Escape(){
        battlePet.stop()
        enemy.stop()
        document.getElementById('battleWin').classList.remove('show')
    }
     document.getElementById('battle').addEventListener('click',showBattle);
     document.getElementById('battleEscape').addEventListener('click',Escape);

     

</script>

</html>

